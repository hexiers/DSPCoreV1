/*======================================================================================================
* @文件名称	:                                                       
* @文件描述	: 	定义
* @创建人		:  	张宇                                                                              
* 创建日期		:   	2020-03-09                                                                
* 修改记录		:   
*                         
======================================================================================================*/
#include"MC_HalApi.h"
/**************************************************************************************************************************************************
* @函数名		:  		HAL_GetLpVol                                                       
* @函数描述	: 		返回以10mV为单位的控制电压值
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*                         
****************************************************************************************************************************************************/
Uint16 HAL_GetLpVol(void)
{
	/* 用户添加代码*/
	return 2800;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_GetHpCurr                                                       
* @函数描述	: 		返回以10mA为单位的母线电流值
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*                         
****************************************************************************************************************************************************/
Uint16 HAL_GetHpCurr(void)
{
	/* 用户添加代码*/
	return 0;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_GetPddTemp                                                       
* @函数描述	: 		返回以0.01℃为单位的功率管温度
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*                         
****************************************************************************************************************************************************/
Uint16 HAL_GetPddTemp(void)
{
	INT16S TemX100 = 0;
	volatile Uint16 Temp = 0;
	Uint16 TempBit = 0;
	static INT16S V[26]  = {4096,4039,3934,3812,3678,3535,3431,3214,2983,2773,2576,2385,2191,1999,1806,1606,1485,1330,1186,1069,971,879,784,687,602,553};
	static INT16S T[26] = {-15,-10,-5,0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105,110};

	TempBit = GetADResultModifyDef(AD_TEMP1,m1HalPara.ADGain,m1HalPara.ADOff);
	//拟合电压温度关系
	if(TempBit >= V[0])
	{
		TemX100 = 100 * T[0];
	}
	else if(TempBit <= V[25])
	{
		TemX100 = 100 * T[25];
	}
	else
	{
		for(Temp = 1;Temp < 25;Temp++)
		{
			if(TempBit > V[Temp])
			{
				break;
			}
		}
		TemX100 = (500 * (V[Temp-1]-TempBit))/(V[Temp-1] - V[Temp]) + 100 * T[Temp-1];
	}
	return TemX100;
	
}
/**************************************************************************************************************************************************
* @函数名		:  		HAL_GetMotorTemp                                                       
* @函数描述	: 		返回以0.01℃为单位的电机温度
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*                         
****************************************************************************************************************************************************/
Uint16 HAL_GetMotorTemp(void)
{
	/* 用户添加代码*/
	return 1000;
	
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_IsFpgaReady
* @函数描述	: 		返回FPGA是否从PROM加载完成，只有FPGA加载完成后，CPU才可以通过并行总线对FPGA配置
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
bool HAL_IsFpgaReady(void)
{
		return FALSE;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_ReloadFpga
* @函数描述	: 		复位FPGA并进行初始化配置
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_ReloadFpga(void)
{
	GpioDataRegs.GPADAT.bit.GPIO10 = 1;
	Delay_ms(10);
	GpioDataRegs.GPADAT.bit.GPIO10 = 0;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_LedToggle
* @函数描述	: 		板内LED闪灯信号
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_LedToggle(void)
{
	LED_RUN = ~LED_RUN;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_SetCpuValid
* @函数描述	: 		是否设置CPU无效
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_SetCpuValid(bool st)
{
	GpioDataRegs.GPADAT.bit.GPIO14 = st ? 1 : 0;
}
/**************************************************************************************************************************************************
* @函数名		:  		HAL_SetInnerLoop
* @函数描述	: 		设置CPU还是FPGA进行内环控制，0为FPGA控制，1为CPU控制
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_SetInnerLoop(bool st) 
{
	GpioDataRegs.GPADAT.bit.GPIO15 = st ? 1 : 0;
}
/**************************************************************************************************************************************************
* @函数名		:  		HAL_IsGateDriveReady
* @函数描述	: 		返回驱动芯片是否准备好，TRUE：准备好，FALSE：未准备好
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
bool HAL_IsGateDriveReady(void)
{
	if(GpioDataRegs.GPADAT.bit.GPIO16)
		return TRUE;
	else
		return FALSE;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_IsGateDriveFault
* @函数描述	: 		返回驱动芯片是否故障，TRUE：故障，FALSE未故障
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
bool HAL_IsGateDriveFault(void)
{
	if(GpioDataRegs.GPADAT.bit.GPIO17)
		return FALSE;
	else
		return TRUE;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_RstGateDriver
* @函数描述	: 		设置驱动芯片复位
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_RstGateDriver(bool st)
{
	GpioDataRegs.GPADAT.bit.GPIO18= 1;
	Delay_ms(10);
	GpioDataRegs.GPADAT.bit.GPIO18 = 0;
}
/**************************************************************************************************************************************************
* @函数名		:  		HAL_SetPreChargeRelayClose                                                       
* @函数描述	: 		设置预充电继电器是否闭合，上电后打开，预充电完成后闭合。
* @创建人		:    	张宇
* 创建日期	:   	2020-10-09
* 修改记录	:
*                         
****************************************************************************************************************************************************/
void HAL_SetPreChargeRelayClose(bool sts)
{
	GpioDataRegs.GPADAT.bit.GPIO7 = sts ? 0 : 1;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_SetFlashHighAddr
* @函数描述	: 		设置参数FLASH的高位地址线
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_SetFlashHighAddr(Uint16 Haddr)
{
	GpioDataRegs.GPADAT.bit.GPIO20= (Haddr & BIT0) ? 1 : 0;
	GpioDataRegs.GPADAT.bit.GPIO21= (Haddr & BIT1) ? 1 : 0;
	GpioDataRegs.GPADAT.bit.GPIO22= (Haddr & BIT2) ? 1 : 0;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_RstFlash
* @函数描述	: 		复位参数FLASH
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_RstFlash(void)
{
	GpioDataRegs.GPADAT.bit.GPIO23= 0;
	Delay_ms(10);
	GpioDataRegs.GPADAT.bit.GPIO23= 1;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_IsFlashReady
* @函数描述	: 		返回参数FLASH是否准备好，
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
bool HAL_IsFlashReady(void)
{
	if(GpioDataRegs.GPADAT.bit.GPIO24)
		return TRUE;
	else
		return FALSE;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_GetHallSector
* @函数描述	: 		返回霍尔信号
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
Uint16 HAL_GetHallSector(void)
{
	return (GpioDataRegs.GPADAT.all >> 25) & 0x07;
	
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_RstAd2s1210
* @函数描述	: 		复位AD2S1210芯片
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
void HAL_RstAd2s1210(void)
{
	GpioDataRegs.GPBDAT.bit.GPIO32= 0;
	Delay_ms(10);
	GpioDataRegs.GPBDAT.bit.GPIO32= 1;
}

/**************************************************************************************************************************************************
* @函数名		:  		HAL_IsPowerGood
* @函数描述	: 		FPGA的电源是否正常，TRUE正常，FALSE不正常
* @创建人		:    	张宇
* 创建日期	:   	2020-03-09
* 修改记录	:
*
****************************************************************************************************************************************************/
bool HAL_IsPowerGood(void)
{
	if(GpioDataRegs.GPBDAT.bit.GPIO48)
		return TRUE;
	else
		return FALSE;
}


